<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P_waste(d) Testing & Validation Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .panel h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 0.95em;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 0.95em;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider-value {
            color: #667eea;
            font-weight: bold;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .data-input-table {
            width: 100%;
            margin-top: 15px;
        }

        .data-input-table th,
        .data-input-table td {
            padding: 8px;
            text-align: center;
        }

        .data-input-table input {
            width: 80px;
            padding: 5px;
            text-align: center;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background: #e9ecef;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ P_waste(d) Testing & Validation Tool</h1>
        <p class="subtitle">Test, compare, and validate different waste probability functions</p>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('function-comparison')">Function Comparison</button>
                <button class="tab-button" onclick="switchTab('data-validation')">Data Validation</button>
                <button class="tab-button" onclick="switchTab('impact-calculator')">Impact Calculator</button>
            </div>

            <!-- Tab 1: Function Comparison -->
            <div id="function-comparison" class="tab-content active">
                <div class="grid-layout">
                    <!-- Configuration Panel -->
                    <div class="panel">
                        <h2>‚öôÔ∏è Function Configuration</h2>

                        <div class="form-group">
                            <label>Select Function Type</label>
                            <select id="functionType" onchange="updateChart()">
                                <option value="sigmoid">Sigmoid (Recommended)</option>
                                <option value="original">Original (Step Function)</option>
                                <option value="linear">Linear</option>
                                <option value="exponential">Exponential</option>
                            </select>
                        </div>

                        <div id="sigmoidParams">
                            <h3 style="margin: 20px 0 15px 0; color: #495057;">Sigmoid Parameters</h3>
                            
                            <div class="slider-group">
                                <div class="slider-label">
                                    <label>Steepness (k)</label>
                                    <span class="slider-value" id="kValue">0.5</span>
                                </div>
                                <input type="range" id="kSlider" class="slider" min="0.1" max="1.0" step="0.05" value="0.5" oninput="updateSlider('k')">
                                <p style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">Higher = sharper transition</p>
                            </div>

                            <div class="slider-group">
                                <div class="slider-label">
                                    <label>Midpoint (d_mid)</label>
                                    <span class="slider-value" id="dMidValue">2.0</span>
                                </div>
                                <input type="range" id="dMidSlider" class="slider" min="0" max="5" step="0.5" value="2.0" oninput="updateSlider('dMid')">
                                <p style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">Days where P_waste = 50%</p>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 25px;">
                            <label>Category Multiplier</label>
                            <select id="categoryMultiplier" onchange="updateChart()">
                                <option value="1.8">Berries (1.8x - High Risk)</option>
                                <option value="1.6">Leafy Greens (1.6x)</option>
                                <option value="1.3">Soft Cheese (1.3x)</option>
                                <option value="1.0" selected>Baseline (1.0x - Meat/Bread)</option>
                                <option value="0.7">Hard Cheese (0.7x)</option>
                                <option value="0.5">Apples (0.5x - Low Risk)</option>
                                <option value="0.2">Canned Goods (0.2x)</option>
                            </select>
                        </div>

                        <div style="margin-top: 25px;">
                            <button class="btn" onclick="updateChart()">üìä Update Chart</button>
                            <button class="btn btn-secondary" onclick="resetDefaults()">üîÑ Reset Defaults</button>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Tip:</strong> Adjust the parameters to see how they affect the waste probability curve. The sigmoid function is recommended for its realistic gradual increase.
                        </div>
                    </div>

                    <!-- Visualization Panel -->
                    <div class="panel">
                        <h2>üìà Probability Curves</h2>
                        <div class="chart-container">
                            <canvas id="probabilityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Comparison Table -->
                <div class="panel">
                    <h2>üìã Detailed Comparison Table</h2>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Days to Expiry</th>
                                <th>Base P_waste</th>
                                <th>Adjusted P_waste</th>
                                <th>Original (Your Formula)</th>
                                <th>Difference</th>
                                <th>Impact Example (1kg chicken)</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 2: Data Validation -->
            <div id="data-validation" class="tab-content">
                <div class="panel">
                    <h2>üìä Validate Against Real Data</h2>
                    
                    <div class="alert alert-info">
                        <strong>Instructions:</strong> Enter your actual waste data below to validate the model. For each day, enter the number of items wasted out of total items at that expiry date.
                    </div>

                    <table class="data-input-table">
                        <thead>
                            <tr>
                                <th>Days to Expiry</th>
                                <th>Items Wasted</th>
                                <th>Total Items</th>
                                <th>Observed Rate</th>
                                <th>Model Prediction</th>
                                <th>Error</th>
                            </tr>
                        </thead>
                        <tbody id="validationTableBody">
                            <tr>
                                <td>0</td>
                                <td><input type="number" id="wasted_0" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_0" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_0">-</td>
                                <td id="predicted_0">-</td>
                                <td id="error_0">-</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td><input type="number" id="wasted_1" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_1" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_1">-</td>
                                <td id="predicted_1">-</td>
                                <td id="error_1">-</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td><input type="number" id="wasted_2" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_2" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_2">-</td>
                                <td id="predicted_2">-</td>
                                <td id="error_2">-</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td><input type="number" id="wasted_3" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_3" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_3">-</td>
                                <td id="predicted_3">-</td>
                                <td id="error_3">-</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td><input type="number" id="wasted_5" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_5" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_5">-</td>
                                <td id="predicted_5">-</td>
                                <td id="error_5">-</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td><input type="number" id="wasted_7" value="0" min="0" onchange="calculateValidation()"></td>
                                <td><input type="number" id="total_7" value="0" min="0" onchange="calculateValidation()"></td>
                                <td id="observed_7">-</td>
                                <td id="predicted_7">-</td>
                                <td id="error_7">-</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="stats-grid" style="margin-top: 30px;">
                        <div class="stat-card">
                            <div class="stat-value" id="meanError">-</div>
                            <div class="stat-label">Mean Absolute Error</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="rmse">-</div>
                            <div class="stat-label">Root Mean Square Error</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="accuracy">-</div>
                            <div class="stat-label">Model Fit Quality</div>
                        </div>
                    </div>

                    <div class="alert alert-warning" style="margin-top: 20px;">
                        <strong>‚ö†Ô∏è Note:</strong> Lower error values indicate better model fit. If errors are high, adjust the k and d_mid parameters in the Function Comparison tab.
                    </div>
                </div>
            </div>

            <!-- Tab 3: Impact Calculator -->
            <div id="impact-calculator" class="tab-content">
                <div class="grid-layout">
                    <div class="panel">
                        <h2>üßÆ Calculate Waste Impact</h2>

                        <div class="form-group">
                            <label>Food Item</label>
                            <input type="text" id="foodItem" value="Chicken Breast" placeholder="e.g., Chicken Breast">
                        </div>

                        <div class="form-group">
                            <label>Food Category</label>
                            <select id="foodCategory">
                                <option value="beef">Beef (99.0 kg CO‚ÇÇe/kg)</option>
                                <option value="pork">Pork (12.0 kg CO‚ÇÇe/kg)</option>
                                <option value="chicken" selected>Chicken (9.0 kg CO‚ÇÇe/kg)</option>
                                <option value="fish">Fish (13.0 kg CO‚ÇÇe/kg)</option>
                                <option value="cheese">Cheese (13.5 kg CO‚ÇÇe/kg)</option>
                                <option value="milk">Milk (8.0 kg CO‚ÇÇe/kg)</option>
                                <option value="bread">Bread (1.5 kg CO‚ÇÇe/kg)</option>
                                <option value="vegetables">Vegetables (2.0 kg CO‚ÇÇe/kg)</option>
                                <option value="berries">Berries (1.5 kg CO‚ÇÇe/kg)</option>
                                <option value="apples">Apples (0.6 kg CO‚ÇÇe/kg)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Weight (kg)</label>
                            <input type="number" id="weight" value="1.0" step="0.1" min="0.1">
                        </div>

                        <div class="form-group">
                            <label>Days to Expiry</label>
                            <input type="number" id="daysToExpiry" value="3" min="0">
                        </div>

                        <div class="form-group">
                            <label>Disposal Method</label>
                            <select id="disposalMethod">
                                <option value="landfill" selected>Landfill (0.5 kg CO‚ÇÇe/kg)</option>
                                <option value="compost">Composting (0.1 kg CO‚ÇÇe/kg)</option>
                                <option value="incineration">Incineration (0.9 kg CO‚ÇÇe/kg)</option>
                                <option value="anaerobic">Anaerobic Digestion (-0.2 kg CO‚ÇÇe/kg)</option>
                            </select>
                        </div>

                        <button class="btn" onclick="calculateImpact()" style="width: 100%; margin-top: 20px;">üî¨ Calculate Impact</button>
                    </div>

                    <div class="panel">
                        <h2>üìä Results</h2>
                        <div id="impactResults" style="display: none;">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="pWasteResult">-</div>
                                    <div class="stat-label">Waste Probability</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="productionImpact">-</div>
                                    <div class="stat-label">Production Impact (kg CO‚ÇÇe)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="disposalImpact">-</div>
                                    <div class="stat-label">Disposal Impact (kg CO‚ÇÇe)</div>
                                </div>
                            </div>

                            <div class="stat-card" style="margin-top: 20px; border-left-width: 6px;">
                                <div class="stat-value" id="totalImpact" style="font-size: 2.5em;">-</div>
                                <div class="stat-label" style="font-size: 1.1em;">Total Expected Waste Impact (kg CO‚ÇÇe)</div>
                            </div>

                            <div class="stat-card" style="margin-top: 20px; background: #d4edda; border-left-color: #28a745;">
                                <div class="stat-value" id="pointsResult" style="color: #28a745;">-</div>
                                <div class="stat-label" style="color: #155724;">Prevention Points (alpha=10)</div>
                            </div>

                            <div class="alert alert-info" style="margin-top: 20px;">
                                <strong>üí° Interpretation:</strong>
                                <p id="interpretation" style="margin-top: 10px;"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Emission factors
        const EF_PRODUCTION = {
            beef: 99.0,
            pork: 12.0,
            chicken: 9.0,
            fish: 13.0,
            cheese: 13.5,
            milk: 8.0,
            bread: 1.5,
            vegetables: 2.0,
            berries: 1.5,
            apples: 0.6
        };

        const EF_DISPOSAL = {
            landfill: 0.5,
            compost: 0.1,
            incineration: 0.9,
            anaerobic: -0.2
        };

        let chart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateChart();
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Update slider display
        function updateSlider(param) {
            if (param === 'k') {
                const value = document.getElementById('kSlider').value;
                document.getElementById('kValue').textContent = parseFloat(value).toFixed(2);
            } else if (param === 'dMid') {
                const value = document.getElementById('dMidSlider').value;
                document.getElementById('dMidValue').textContent = parseFloat(value).toFixed(1);
            }
            updateChart();
        }

        // Reset to defaults
        function resetDefaults() {
            document.getElementById('kSlider').value = 0.5;
            document.getElementById('dMidSlider').value = 2.0;
            document.getElementById('kValue').textContent = '0.50';
            document.getElementById('dMidValue').textContent = '2.0';
            document.getElementById('functionType').value = 'sigmoid';
            document.getElementById('categoryMultiplier').value = '1.0';
            updateChart();
        }

        // Calculate P_waste for different functions
        function calculatePWaste(d, functionType, k, dMid) {
            switch(functionType) {
                case 'sigmoid':
                    return 1 / (1 + Math.exp(k * (d - dMid)));
                case 'original':
                    if (d <= 1) return 0.95;
                    if (d <= 3) return 0.85;
                    if (d <= 7) return 0.60;
                    return 0.30;
                case 'linear':
                    return Math.max(0, Math.min(1, 1 - d/10));
                case 'exponential':
                    return Math.max(0, Math.min(1, Math.exp(-d/3)));
            }
        }

        // Update chart
        function updateChart() {
            const functionType = document.getElementById('functionType').value;
            const k = parseFloat(document.getElementById('kSlider').value);
            const dMid = parseFloat(document.getElementById('dMidSlider').value);
            const multiplier = parseFloat(document.getElementById('categoryMultiplier').value);

            const days = [];
            const basePWaste = [];
            const adjustedPWaste = [];
            const originalPWaste = [];

            for (let d = 0; d <= 10; d += 0.1) {
                days.push(d);
                const base = calculatePWaste(d, functionType, k, dMid);
                basePWaste.push(base);
                adjustedPWaste.push(Math.min(base * multiplier, 0.95));
                originalPWaste.push(calculatePWaste(d, 'original', k, dMid));
            }

            const ctx = document.getElementById('probabilityChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [
                        {
                            label: 'Base P_waste',
                            data: basePWaste,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0
                        },
                        {
                            label: 'Adjusted P_waste (with category multiplier)',
                            data: adjustedPWaste,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            borderWidth: 3,
                            pointRadius: 0
                        },
                        {
                            label: 'Original (Step Function)',
                            data: originalPWaste,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Days to Expiry',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Waste Probability',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 0,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + (context.parsed.y * 100).toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            });

            // Update comparison table
            updateComparisonTable(functionType, k, dMid, multiplier);
        }

        // Update comparison table
        function updateComparisonTable(functionType, k, dMid, multiplier) {
            const tbody = document.getElementById('comparisonTableBody');
            tbody.innerHTML = '';

            const testDays = [0, 1, 2, 3, 5, 7, 10];
            
            testDays.forEach(d => {
                const base = calculatePWaste(d, functionType, k, dMid);
                const adjusted = Math.min(base * multiplier, 0.95);
                const original = calculatePWaste(d, 'original', k, dMid);
                const diff = ((adjusted - original) * 100).toFixed(1);
                
                // Example impact for 1kg chicken
                const efProduction = 9.0; // chicken
                const efDisposal = 0.5; // landfill
                const impact = (1.0 * efProduction * adjusted + 1.0 * efDisposal * adjusted).toFixed(2);

                const row = `
                    <tr>
                        <td><strong>${d}</strong></td>
                        <td>${(base * 100).toFixed(1)}%</td>
                        <td>${(adjusted * 100).toFixed(1)}%</td>
                        <td>${(original * 100).toFixed(1)}%</td>
                        <td style="color: ${diff >= 0 ? '#28a745' : '#dc3545'}">${diff > 0 ? '+' : ''}${diff}%</td>
                        <td>${impact} kg CO‚ÇÇe</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Calculate validation
        function calculateValidation() {
            const k = parseFloat(document.getElementById('kSlider').value);
            const dMid = parseFloat(document.getElementById('dMidSlider').value);
            const testDays = [0, 1, 2, 3, 5, 7];
            
            let sumError = 0;
            let sumSquaredError = 0;
            let count = 0;

            testDays.forEach(d => {
                const wasted = parseInt(document.getElementById(`wasted_${d}`).value) || 0;
                const total = parseInt(document.getElementById(`total_${d}`).value) || 0;
                
                if (total > 0) {
                    const observed = wasted / total;
                    const predicted = calculatePWaste(d, 'sigmoid', k, dMid);
                    const error = Math.abs(observed - predicted);
                    
                    document.getElementById(`observed_${d}`).textContent = (observed * 100).toFixed(1) + '%';
                    document.getElementById(`predicted_${d}`).textContent = (predicted * 100).toFixed(1) + '%';
                    document.getElementById(`error_${d}`).textContent = (error * 100).toFixed(1) + '%';
                    
                    sumError += error;
                    sumSquaredError += error * error;
                    count++;
                } else {
                    document.getElementById(`observed_${d}`).textContent = '-';
                    document.getElementById(`predicted_${d}`).textContent = '-';
                    document.getElementById(`error_${d}`).textContent = '-';
                }
            });

            if (count > 0) {
                const mae = sumError / count;
                const rmse = Math.sqrt(sumSquaredError / count);
                const accuracy = Math.max(0, 100 - (mae * 100));

                document.getElementById('meanError').textContent = (mae * 100).toFixed(1) + '%';
                document.getElementById('rmse').textContent = (rmse * 100).toFixed(1) + '%';
                document.getElementById('accuracy').textContent = accuracy.toFixed(0) + '%';
            }
        }

        // Calculate impact
        function calculateImpact() {
            const foodItem = document.getElementById('foodItem').value;
            const category = document.getElementById('foodCategory').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const daysToExpiry = parseInt(document.getElementById('daysToExpiry').value);
            const disposalMethod = document.getElementById('disposalMethod').value;

            const k = parseFloat(document.getElementById('kSlider').value);
            const dMid = parseFloat(document.getElementById('dMidSlider').value);

            // Calculate P_waste
            const pWaste = calculatePWaste(daysToExpiry, 'sigmoid', k, dMid);

            // Get emission factors
            const efProduction = EF_PRODUCTION[category];
            const efDisposal = EF_DISPOSAL[disposalMethod];

            // Calculate impacts
            const productionImpact = weight * efProduction * pWaste;
            const disposalImpact = weight * efDisposal * pWaste;
            const totalImpact = productionImpact + disposalImpact;
            const points = totalImpact * 10; // alpha = 10

            // Display results
            document.getElementById('impactResults').style.display = 'block';
            document.getElementById('pWasteResult').textContent = (pWaste * 100).toFixed(1) + '%';
            document.getElementById('productionImpact').textContent = productionImpact.toFixed(2);
            document.getElementById('disposalImpact').textContent = disposalImpact.toFixed(2);
            document.getElementById('totalImpact').textContent = totalImpact.toFixed(2);
            document.getElementById('pointsResult').textContent = Math.round(points);

            // Generate interpretation
            let interpretation = `Your ${weight}kg of ${foodItem} has ${daysToExpiry} day(s) until expiry. `;
            
            if (pWaste > 0.70) {
                interpretation += `‚ö†Ô∏è <strong>HIGH RISK:</strong> There's a ${(pWaste*100).toFixed(0)}% chance this will be wasted. Use it TODAY to prevent ${totalImpact.toFixed(2)} kg CO‚ÇÇe of emissions and earn ${Math.round(points)} points!`;
            } else if (pWaste > 0.40) {
                interpretation += `‚ö†Ô∏è <strong>MODERATE RISK:</strong> There's a ${(pWaste*100).toFixed(0)}% chance of waste. Plan to use within the next 1-2 days to prevent ${totalImpact.toFixed(2)} kg CO‚ÇÇe and earn ${Math.round(points)} points.`;
            } else if (pWaste > 0.15) {
                interpretation += `‚úÖ <strong>LOW RISK:</strong> Waste probability is ${(pWaste*100).toFixed(0)}%. You have time, but don't forget about it! If consumed, you'll prevent ${totalImpact.toFixed(2)} kg CO‚ÇÇe and earn ${Math.round(points)} points.`;
            } else {
                interpretation += `‚úÖ <strong>VERY LOW RISK:</strong> Only ${(pWaste*100).toFixed(0)}% chance of waste. This item is fresh - plenty of time to use it. Potential prevention: ${totalImpact.toFixed(2)} kg CO‚ÇÇe.`;
            }

            document.getElementById('interpretation').innerHTML = interpretation;
        }
    </script>
</body>
</html>